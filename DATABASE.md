# Database Schema Documentation

This document describes the database schema for the Ispilo backend, which uses PostgreSQL (managed via JPA/Hibernate).

## Entity Relationship Summary

- **User**: The core entity representing a registered user.
- **Seller**: An extension of the User entity for business accounts (One-to-One with User).
- **Post**: Social media posts created by Users.
- **Comment**: Comments on Posts by Users.
- **Product**: Items listed for sale by Sellers.
- **Conversation**: Chat rooms between Users.
- **Message**: Individual messages within a Conversation.

---

## Tables

### 1. `users`
Stores user profile and authentication information.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `email` | String | Unique email address |
| `password_hash` | String | BCrypt hashed password |
| `name` | String | Display name |
| `avatar` | String | URL to profile image |
| `phone` | String | Contact number |
| `phone_privacy_public` | Boolean | Visibility of phone number |
| `country_code` | String | ISO country code |
| `is_verified` | Boolean | Email/Identity verification status |
| `bio` | String (500) | User biography |
| `location` | String | User location |
| `created_at` | Timestamp | Creation date |
| `updated_at` | Timestamp | Last update date |

### 2. `sellers`
Extended information for users who want to sell products.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `user_id` | UUID (String) | Foreign Key to `users` (Unique) |
| `business_name` | String | Name of the business |
| `business_description`| String (1000)| Description of the business |
| `business_logo` | String | URL to business logo |
| `business_address` | String | Physical address |
| `is_verified` | Boolean | Business verification status |
| `verification_document`| String | URL to verification document |

### 3. `posts`
Social media content shared by users.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `user_id` | UUID (String) | Foreign Key to `users` |
| `description` | String (2000) | Post content |
| `likes_count` | Integer | Number of likes |
| `comments_count` | Integer | Number of comments |
| `view_count` | Integer | Number of views |
| `created_at` | Timestamp | Creation date |

**Note:** Media URLs are stored in a separate collection table `post_media`.

### 4. `products`
Items listed for sale by sellers.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `seller_id` | UUID (String) | Foreign Key to `sellers` |
| `name` | String | Product name |
| `description` | String (2000) | Product description |
| `price` | Decimal (10,2) | Product price |
| `stock_quantity` | Integer | Available stock |
| `category` | String | Product category |
| `is_available` | Boolean | Availability status |

**Note:** Product images are stored in a separate collection table `product_images`.

### 5. `comments`
User comments on posts.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `post_id` | UUID (String) | Foreign Key to `posts` |
| `user_id` | UUID (String) | Foreign Key to `users` |
| `content` | String (500) | Comment text |
| `created_at` | Timestamp | Creation date |

### 6. `conversations`
Chat groups or direct messages.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `type` | String (Enum) | `DIRECT` or `GROUP` |
| `last_message` | String | Snippet of the last message |
| `last_message_at` | Timestamp | Time of the last message |
| `encryption_key` | String | Key for E2EE (if applicable) |

**Note:** Participants are linked via `conversation_participants` join table.

### 7. `messages`
Individual chat messages.

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | UUID (String) | Primary Key |
| `client_msg_id` | String | Unique ID generated by client |
| `conversation_id` | UUID (String) | Foreign Key to `conversations` |
| `sender_id` | UUID (String) | Foreign Key to `users` |
| `type` | String (Enum) | `TEXT`, `IMAGE`, `VIDEO`, etc. |
| `content` | String (2000) | Message text |
| `media_url` | String | URL to media attachment |
| `is_read` | Boolean | Read status |
| `created_at` | Timestamp | Creation date |

---

## Indexes
- `idx_email` on `users(email)`
- `idx_user_id` on `posts(user_id)`, `sellers(user_id)`, `comments(user_id)`
- `idx_post_id` on `comments(post_id)`
- `idx_seller_id` on `products(seller_id)`
- `idx_conversation_id` on `messages(conversation_id)`
